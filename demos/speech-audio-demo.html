<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synopticon API - Comprehensive Speech & Audio Analysis Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .demo-header {
            background: linear-gradient(135deg, #2C3E50 0%, #4A90E2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .demo-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .demo-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .demo-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            height: calc(100vh - 200px);
        }

        .control-panel {
            padding: 30px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .metrics-panel {
            padding: 30px;
            background: white;
        }

        .control-section {
            margin-bottom: 30px;
        }

        .control-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .demo-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4A90E2;
            color: white;
        }

        .btn-primary:hover {
            background: #357ABD;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #E74C3C;
            color: white;
        }

        .btn-danger:hover {
            background: #C0392B;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6C757D;
            color: white;
        }

        .btn-secondary:hover {
            background: #5A6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .status-inactive {
            background: #FFF3CD;
            color: #856404;
        }

        .status-active {
            background: #D4EDDA;
            color: #155724;
            animation: pulse 2s infinite;
        }

        .status-error {
            background: #F8D7DA;
            color: #721C24;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4A90E2;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .live-data {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .live-data h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: #495057;
        }

        .data-value {
            color: #6c757d;
            font-family: 'Courier New', monospace;
        }

        .data-value.highlight {
            color: #4A90E2;
            font-weight: 600;
        }

        .event-log {
            height: 300px;
            overflow-y: auto;
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .log-entry {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .log-timestamp {
            color: #95a5a6;
        }

        .log-info {
            color: #3498db;
        }

        .log-warn {
            color: #f39c12;
        }

        .log-error {
            color: #e74c3c;
        }

        .log-message {
            color: #ecf0f1;
        }

        .transcription-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .transcription-text {
            font-size: 1.2rem;
            line-height: 1.5;
        }

        .transcription-confidence {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 10px;
        }

        .config-panel {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
        }

        .config-group {
            margin-bottom: 15px;
        }

        .config-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }

        .config-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .config-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
        }

        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4A90E2, #667eea);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .component-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .component-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
            font-size: 0.85rem;
        }

        .component-active {
            background: #d4edda;
            color: #155724;
        }

        .component-inactive {
            background: #fff3cd;
            color: #856404;
        }

        @media (max-width: 768px) {
            .demo-content {
                grid-template-columns: 1fr;
                height: auto;
            }

            .demo-header h1 {
                font-size: 2rem;
            }

            .control-panel,
            .metrics-panel {
                padding: 20px;
            }

            .demo-controls {
                flex-direction: column;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <header class="demo-header">
            <h1>üé§ Speech & Audio Analysis Demo</h1>
            <p>Comprehensive demonstration of all speech and audio analysis features</p>
        </header>

        <div class="demo-content">
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>üéõÔ∏è Demo Controls</h3>
                    <div class="status-indicator" id="demoStatus">
                        üî¥ Demo Inactive
                    </div>
                    
                    <div class="demo-controls">
                        <button id="startDemo" class="btn btn-primary">
                            ‚ñ∂Ô∏è Start Demo
                        </button>
                        <button id="stopDemo" class="btn btn-danger" disabled>
                            ‚èπÔ∏è Stop Demo
                        </button>
                        <button id="generateReport" class="btn btn-secondary" disabled>
                            üìã Export Report
                        </button>
                    </div>

                    <div class="component-status" id="componentStatus">
                        <!-- Component status indicators will be populated here -->
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìä Live Transcription</h3>
                    <div class="transcription-display" id="transcriptionDisplay">
                        <div>
                            <div class="transcription-text" id="transcriptionText">
                                Speak to see real-time transcription...
                            </div>
                            <div class="transcription-confidence" id="transcriptionConfidence">
                                Confidence: 0%
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>‚öôÔ∏è Configuration</h3>
                    <div class="config-panel">
                        <div class="config-group">
                            <label class="config-label" for="languageSelect">Language</label>
                            <select id="languageSelect" class="config-select">
                                <option value="en-US">English (US)</option>
                                <option value="en-GB">English (UK)</option>
                                <option value="es-ES">Spanish</option>
                                <option value="fr-FR">French</option>
                                <option value="de-DE">German</option>
                            </select>
                        </div>

                        <div class="config-group">
                            <label class="config-label" for="vadSensitivity">VAD Sensitivity</label>
                            <input type="range" id="vadSensitivity" min="0" max="1" step="0.1" value="0.5" class="config-input">
                        </div>

                        <div class="config-group">
                            <label class="config-label" for="emotionSmoothing">Emotion Smoothing</label>
                            <input type="range" id="emotionSmoothing" min="0" max="1" step="0.1" value="0.3" class="config-input">
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìù Event Log</h3>
                    <div class="event-log" id="eventLog">
                        <div class="log-entry">
                            <span class="log-timestamp">[00:00:00.000]</span>
                            <span class="log-info">‚ÑπÔ∏è</span>
                            <span class="log-message">Demo ready to start...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metrics Panel -->
            <div class="metrics-panel">
                <div class="control-section">
                    <h3>üìà Performance Metrics</h3>
                    <div class="metrics-grid" id="metricsGrid">
                        <div class="metric-card">
                            <div class="metric-value" id="transcriptionsCount">0</div>
                            <div class="metric-label">Transcriptions</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="analysesCount">0</div>
                            <div class="metric-label">LLM Analyses</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="vadCount">0</div>
                            <div class="metric-label">VAD Triggers</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="speakerChanges">0</div>
                            <div class="metric-label">Speaker Changes</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="emotionDetections">0</div>
                            <div class="metric-label">Emotion Changes</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="conversationEvents">0</div>
                            <div class="metric-label">Flow Events</div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üîä Current Audio Quality</h3>
                    <div class="live-data" id="audioQualityData">
                        <div class="data-item">
                            <span class="data-label">Quality Level:</span>
                            <span class="data-value" id="qualityLevel">Unknown</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Signal-to-Noise:</span>
                            <span class="data-value" id="snrLevel">N/A dB</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Clipping:</span>
                            <span class="data-value" id="clippingLevel">N/A</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="qualityProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üë§ Speaker & Emotion Analysis</h3>
                    <div class="live-data" id="speakerEmotionData">
                        <div class="data-item">
                            <span class="data-label">Current Speaker:</span>
                            <span class="data-value" id="currentSpeaker">None</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Dominant Emotion:</span>
                            <span class="data-value" id="dominantEmotion">Unknown</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Arousal Level:</span>
                            <span class="data-value" id="arousalLevel">N/A</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Valence Level:</span>
                            <span class="data-value" id="valenceLevel">N/A</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>‚ö° Speaking Pace & Flow</h3>
                    <div class="live-data" id="paceFlowData">
                        <div class="data-item">
                            <span class="data-label">Words Per Minute:</span>
                            <span class="data-value" id="wordsPerMinute">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Fluency Score:</span>
                            <span class="data-value" id="fluencyScore">N/A</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Filler Words:</span>
                            <span class="data-value" id="fillerWords">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Conversation Quality:</span>
                            <span class="data-value" id="conversationQuality">N/A</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üß† Recent LLM Analyses</h3>
                    <div class="live-data" id="recentAnalyses">
                        <div class="data-item">
                            <span class="data-label">Latest Analysis:</span>
                            <span class="data-value" id="latestAnalysis">None yet...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createComprehensiveSpeechAudioDemo } from './speech-audio-comprehensive-demo.js';

        // Global demo instance
        let demo = null;
        let updateInterval = null;

        // DOM elements
        const elements = {
            startDemo: document.getElementById('startDemo'),
            stopDemo: document.getElementById('stopDemo'),
            generateReport: document.getElementById('generateReport'),
            demoStatus: document.getElementById('demoStatus'),
            componentStatus: document.getElementById('componentStatus'),
            transcriptionText: document.getElementById('transcriptionText'),
            transcriptionConfidence: document.getElementById('transcriptionConfidence'),
            eventLog: document.getElementById('eventLog'),
            languageSelect: document.getElementById('languageSelect'),
            vadSensitivity: document.getElementById('vadSensitivity'),
            emotionSmoothing: document.getElementById('emotionSmoothing'),
            
            // Metrics
            transcriptionsCount: document.getElementById('transcriptionsCount'),
            analysesCount: document.getElementById('analysesCount'),
            vadCount: document.getElementById('vadCount'),
            speakerChanges: document.getElementById('speakerChanges'),
            emotionDetections: document.getElementById('emotionDetections'),
            conversationEvents: document.getElementById('conversationEvents'),
            
            // Audio quality
            qualityLevel: document.getElementById('qualityLevel'),
            snrLevel: document.getElementById('snrLevel'),
            clippingLevel: document.getElementById('clippingLevel'),
            qualityProgress: document.getElementById('qualityProgress'),
            
            // Speaker & emotion
            currentSpeaker: document.getElementById('currentSpeaker'),
            dominantEmotion: document.getElementById('dominantEmotion'),
            arousalLevel: document.getElementById('arousalLevel'),
            valenceLevel: document.getElementById('valenceLevel'),
            
            // Pace & flow
            wordsPerMinute: document.getElementById('wordsPerMinute'),
            fluencyScore: document.getElementById('fluencyScore'),
            fillerWords: document.getElementById('fillerWords'),
            conversationQuality: document.getElementById('conversationQuality'),
            
            // Analyses
            latestAnalysis: document.getElementById('latestAnalysis')
        };

        // Initialize demo
        const initializeDemo = async () => {
            try {
                demo = createComprehensiveSpeechAudioDemo();
                await demo.initialize();
                
                logToUI('üéâ Demo initialized successfully!', 'info');
                elements.startDemo.disabled = false;
                
            } catch (error) {
                logToUI(`‚ùå Failed to initialize demo: ${error.message}`, 'error');
                console.error('Demo initialization error:', error);
            }
        };

        // Start demo
        const startDemo = async () => {
            try {
                elements.startDemo.disabled = true;
                elements.stopDemo.disabled = false;
                elements.generateReport.disabled = false;
                
                updateDemoStatus('üü¢ Demo Active', 'status-active');
                
                await demo.start();
                
                // Start UI updates
                updateInterval = setInterval(updateUI, 100);
                
                logToUI('üé¨ Demo started! Please speak...', 'info');
                
            } catch (error) {
                logToUI(`‚ùå Failed to start demo: ${error.message}`, 'error');
                elements.startDemo.disabled = false;
                elements.stopDemo.disabled = true;
                updateDemoStatus('üî¥ Demo Error', 'status-error');
            }
        };

        // Stop demo
        const stopDemo = async () => {
            try {
                if (updateInterval) {
                    clearInterval(updateInterval);
                    updateInterval = null;
                }
                
                await demo.stop();
                
                elements.startDemo.disabled = false;
                elements.stopDemo.disabled = true;
                
                updateDemoStatus('üü° Demo Stopped', 'status-inactive');
                
                logToUI('üõë Demo stopped', 'info');
                
            } catch (error) {
                logToUI(`‚ùå Failed to stop demo: ${error.message}`, 'error');
            }
        };

        // Generate and download report
        const generateReport = async () => {
            try {
                const report = await demo.generateReport('json');
                
                // Create download link
                const blob = new Blob([report.data], { type: report.mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = report.filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                logToUI('üìã Report generated and downloaded!', 'info');
                
            } catch (error) {
                logToUI(`‚ùå Failed to generate report: ${error.message}`, 'error');
            }
        };

        // Update UI with demo data
        const updateUI = () => {
            if (!demo || !demo.isRunning()) return;
            
            const state = demo.getState();
            const metrics = demo.getMetrics();
            const currentData = demo.getCurrentData();
            
            // Update metrics
            elements.transcriptionsCount.textContent = metrics.totalTranscriptions;
            elements.analysesCount.textContent = metrics.totalAnalyses;
            elements.vadCount.textContent = metrics.vadDetections;
            elements.speakerChanges.textContent = metrics.speakerChanges;
            elements.emotionDetections.textContent = metrics.emotionDetections;
            elements.conversationEvents.textContent = metrics.conversationEvents;
            
            // Update transcription
            if (currentData.transcription) {
                elements.transcriptionText.textContent = currentData.transcription;
                elements.transcriptionConfidence.textContent = 
                    `Confidence: ${(currentData.confidence * 100).toFixed(1)}%`;
            }
            
            // Update audio quality
            if (currentData.audioQuality?.current) {
                const quality = currentData.audioQuality.current;
                elements.qualityLevel.textContent = quality.quality || 'Unknown';
                elements.snrLevel.textContent = quality.signalToNoise ? 
                    `${quality.signalToNoise.toFixed(1)} dB` : 'N/A dB';
                elements.clippingLevel.textContent = quality.clipping ? 
                    `${(quality.clipping * 100).toFixed(1)}%` : 'N/A';
                
                // Update progress bar (assuming quality score 0-1)
                const qualityScore = quality.score || 0;
                elements.qualityProgress.style.width = `${qualityScore * 100}%`;
            }
            
            // Update speaker & emotion
            elements.currentSpeaker.textContent = currentData.currentSpeaker || 'None';
            
            if (currentData.emotion) {
                elements.dominantEmotion.textContent = currentData.emotion.dominant || 'Unknown';
                elements.arousalLevel.textContent = currentData.emotion.arousal ? 
                    currentData.emotion.arousal.toFixed(2) : 'N/A';
                elements.valenceLevel.textContent = currentData.emotion.valence ? 
                    currentData.emotion.valence.toFixed(2) : 'N/A';
            }
            
            // Update pace & flow
            if (currentData.speakingPace) {
                elements.wordsPerMinute.textContent = currentData.speakingPace.wordsPerMinute ? 
                    currentData.speakingPace.wordsPerMinute.toFixed(0) : '0';
                elements.fluencyScore.textContent = currentData.speakingPace.fluencyScore ? 
                    `${(currentData.speakingPace.fluencyScore * 100).toFixed(0)}%` : 'N/A';
                elements.fillerWords.textContent = currentData.speakingPace.fillerWords || '0';
            }
            
            if (currentData.conversationFlow?.currentMetrics) {
                const quality = currentData.conversationFlow.currentMetrics.metrics.participationBalance;
                elements.conversationQuality.textContent = `${(quality * 100).toFixed(0)}%`;
            }
            
            // Update component status
            updateComponentStatus();
        };

        // Update component status indicators
        const updateComponentStatus = () => {
            if (!demo) return;
            
            const components = demo.getComponents();
            const componentNames = Object.keys(components);
            
            elements.componentStatus.innerHTML = '';
            
            componentNames.forEach(name => {
                const div = document.createElement('div');
                div.className = `component-item ${components[name] ? 'component-active' : 'component-inactive'}`;
                div.textContent = name.replace(/([A-Z])/g, ' $1').trim();
                elements.componentStatus.appendChild(div);
            });
        };

        // Update demo status
        const updateDemoStatus = (text, className) => {
            elements.demoStatus.textContent = text;
            elements.demoStatus.className = `status-indicator ${className}`;
        };

        // Log message to UI
        const logToUI = (message, type = 'info') => {
            const timestamp = new Date().toISOString().substr(11, 12);
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const icon = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            entry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-${type}">${icon}</span>
                <span class="log-message">${message}</span>
            `;
            
            elements.eventLog.appendChild(entry);
            elements.eventLog.scrollTop = elements.eventLog.scrollHeight;
            
            // Limit log entries
            while (elements.eventLog.children.length > 50) {
                elements.eventLog.removeChild(elements.eventLog.firstChild);
            }
        };

        // Event listeners
        elements.startDemo.addEventListener('click', startDemo);
        elements.stopDemo.addEventListener('click', stopDemo);
        elements.generateReport.addEventListener('click', generateReport);

        // Configuration change handlers
        elements.languageSelect.addEventListener('change', (e) => {
            if (demo) {
                demo.updateConfig({ language: e.target.value });
                logToUI(`Language changed to: ${e.target.value}`, 'info');
            }
        });

        elements.vadSensitivity.addEventListener('input', (e) => {
            if (demo) {
                demo.updateConfig({ vadSensitivity: parseFloat(e.target.value) });
                logToUI(`VAD sensitivity: ${e.target.value}`, 'info');
            }
        });

        elements.emotionSmoothing.addEventListener('input', (e) => {
            if (demo) {
                demo.updateConfig({ emotionSmoothing: parseFloat(e.target.value) });
                logToUI(`Emotion smoothing: ${e.target.value}`, 'info');
            }
        });

        // Global function for demo updates (called from demo)
        window.updateDemoMetrics = (data) => {
            // This function is called by the demo to update UI
            // Already handled by updateUI() interval
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            logToUI('üöÄ Initializing Speech & Audio Analysis Demo...', 'info');
            initializeDemo();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', async () => {
            if (demo && demo.isRunning()) {
                await demo.stop();
            }
        });
    </script>
</body>
</html>